#include <iostream>
using namespace std;

class Node {
    public:
    int rollNo;
    Node* left;
    Node* right;
    int height;

    Node(int rollnum){
        rollNo=rollnum;
        left=right=NULL;
        height=1;
    }
};

int getHeight(Node* n){
   if (n==NULL){
        return 0;
    }
    return n->height;
}

int getBalance(Node* n){
    if (n==NULL){
        return 0;
    }
    return getHeight(n->left)-getHeight(n->right);
}

int max(int x, int y){
    if (x>y){
        return x;
    }
    return y;
}

Node* RightRot(Node* y){
    Node* x = y->left;
    Node* T2 = x->right;

    x->right=y;
    y->left=T2;

    y->height=1 + max(getHeight(y->left), getHeight(y->right));
    x->height=1 + max(getHeight(x->left), getHeight(x->right));

    return x;
}

Node* LeftRot(Node* x){
    Node* y = x->right;
    Node* T2 = y->left;

    y->left=x;
    x->right=T2;

    x->height=1 + max(getHeight(x->left), getHeight(x->right));
    y->height=1 + max(getHeight(y->left), getHeight(y->right));

    return y;
}

Node* insert(Node* node, int rollNo){
    if (node==NULL){
        return new Node(rollNo);
    }

    if (rollNo<node->rollNo){
        node->left = insert(node->left, rollNo);
    }
    else if (rollNo>node->rollNo){
        node->right=insert(node->right, rollNo);
    }
    else{
        return node;
    }

    node->height=1 + max(getHeight(node->left), getHeight(node->right));

    int balance = getBalance(node);

    if (balance > 1 && rollNo < node->left->rollNo){
        return RightRot(node);
    }

    if (balance < -1 && rollNo < node->right->rollNo){
        return LeftRot(node);
    }

    if (balance > 1 && rollNo < node->left->rollNo){
        node->left=LeftRot(node->left);
        return RightRot(node);
    }

    if (balance < -1 && rollNo < node->right->rollNo){
        node->right=LeftRot(node->right);
        return LeftRot(node);
    }

    return node;
}

bool search(Node* root, int rollNo){
    if (root==NULL){
        return false;
    }
    if (root->rollNo==rollNo){
        return true;
    }
    else if (rollNo<root->rollNo){
        return search(root->left, rollNo);
    }
    else {
        return search(root->right, rollNo);
    }
}

Node* minValueNode(Node* node) {
    Node* current = node;
    while (current->left != NULL)
        current = current->left;
    return current;
}

Node* deleteNode(Node* root, int rollNo){
    if (root==NULL){
        return root;
    }

    if (rollNo<root->rollNo){
        root->left=deleteNode(root->left, rollNo);
    }
    else if (rollNo>root->rollNo){
        root->right=deleteNode(root->right, rollNo);
    }
    else {
       if (root->left == NULL || root->right == NULL) {
        Node* temp = NULL;

        if (root->left != NULL)
            temp = root->left;
        else if (root->right != NULL)
            temp = root->right;

        if (temp == NULL) {
            temp = root;
            root = NULL;
        }
        else {
            *root = *temp;   
        }

        delete temp;
    } 
        else {
        Node* temp = minValueNode(root->right);
        root->rollNo = temp->rollNo;
        root->right = deleteNode(root->right, temp->rollNo);
        }
    }

    if (root == NULL)
        return root;

    root->height = 1 + max(getHeight(root->left), getHeight(root->right));

    int balance = getBalance(root);

    if (balance > 1 && getBalance(root->left) >= 0)
        return RightRot(root);

    if (balance > 1 && getBalance(root->left) < 0) {
        root->left = LeftRot(root->left);
        return RightRot(root);
    }

    if (balance < -1 && getBalance(root->right) <= 0)
        return LeftRot(root);

    if (balance < -1 && getBalance(root->right) > 0) {
        root->right = RightRot(root->right);
        return LeftRot(root);
    }
    return root;
}

void inorder(Node* root) {
    if (root != NULL) {
        inorder(root->left);
        cout << root->rollNo << " ";
        inorder(root->right);
    }
}

void displayHeight(Node* root) {
    if (root == NULL)
        cout << "Height: 0\n";
    else
        cout << "Height of tree: " << root->height << endl;
}

int main() {
    Node* root = NULL;

    cout << "Inserting initial student roll numbers...\n";
    int initialRolls[] = {10, 20, 30, 40, 50};

    for (int i=0; i<5; i++) {
        int r=initialRolls[i];
        root = insert(root, r);
    }

    cout << "Inorder traversal before insertion of 15: ";
    inorder(root);
    cout << endl;
    displayHeight(root);

    cout << "\nInserting new student (Roll No. 15)...\n";
    root = insert(root, 15);

    cout << "Inorder traversal after inserting 15: ";
    inorder(root);
    cout << endl;
    displayHeight(root);

    cout << "\nSearching for student with roll number 25...\n";
    if (search(root, 25)) {
        cout << "Student with roll number 25 FOUND!\n";
    } else {
        cout << "Student with roll number 25 NOT FOUND.\n";
    }

    cout << "\nDeleting student with roll number 20.\n";
    root = deleteNode(root, 20);

    cout << "Inorder traversal after deleting 20: ";
    inorder(root);
    cout << endl;
    displayHeight(root);

    return 0;
}
